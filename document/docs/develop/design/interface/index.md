title: 接口设计

## 一般性说明和注记

!!! note "需要登录"
    
    若该 API 接口需要以登录用户的身份进行访问，在该接口说明的第一行将会有 **需要登录** 字样。
    
    用户认证的方式将会在[这个接口](users.md#get-apiuserstestlogin)进行规定。
    
    如果未登录用户访问这些接口，则会返回 **401** 错误。
    
!!! note "需要权限"

    若该 API 接口需要用户在项目内为某一角色才能够访问，则在该接口说明的第一行将会有 **需要<角色>权限** 字样，其中 <角色> 代表访问该接口所需的角色（管理员、系统工程师、开发工程师、质量保证工程师）。显然，这一要求蕴含了 需要登录。
    
    需要注意的是，角色信息是局限于某一项目的，因此对项目存在性的检查将会高于角色权限的检查。具体地，如果访问的 URL 不属于任何项目，将会返回 **404** 错误；若项目存在，但该用户并不具有对应的权限，将会返回 **403** 错误。
    
!!! note "展示格式"

    所有 API 在将会以 `METHOD path` 的方式呈现，其中 `METHOD` 为请求方法（`GET`, `POST` 等）`path` 为相对路径。路径中的所有变量，将会以 `:param` 的格式进行标注。

    说明部分将会以文字说明该 API 的功能。
    
    参数部分将会说明该接口的参数列表。其中，在 `path` 中标注的参数需要出现在路径的相应位置；而对于其它参数，如果为 `GET` 请求，则应出现在 param 参数（即 URL `?` 后的部分），如果为 `POST` 请求，则应出现在请求体（request body）中。如果两部分有重名的参数，则会用括号标注。

    在后文中所提到的数据类型，均按照 [`typescript`](https://www.typescriptlang.org/) 的类型标注模式进行标注。同时所有数据类型都能够在 JSON 中得到对应。值得注意的的是，`?` 代表可选参数，等价于 `undefined`，后文中将会叙述为 **参数不存在**，注意与参数为空（一般指空字符串）进行区分。特别地，除特殊说明外，文中的 `number` 参数额外添加了是否为非负整数的检查。
    
    返回部分将会说明该接口的返回值。若无特殊说明，第一条为正常情况返回值，其余均为异常情况返回值。具体格式在后面进行说明。
    
!!! note "返回值"

    若无特殊说明，返回的 body 均为 `application/json` 格式，且均只包含两项：
    
    ``` json
    {
        code: // return code
        data: // response data
    }
    ```
    
    而在返回值部分列出的 `code` 和 `data`，分别对应了这两个元素。
    
    HTTP 返回码（response code） 由 `code` 决定：若 `code` 为 200，则返回码为该请求方法的默认成功返回码（如 GET 为 200, POST 为 201 等）；否则，返回码即为 `code`。特别地，如果返回的是缓存数据，则会返回 304 Not Modified。
    
    在后文描述 `data` 时，类似于 YAML，将采用缩进表示不同元素的结构关系。例如：
    
    + data:
        - `foo`: `number`
        - `bar`: `string`
    
    则表示 `data` 项的类型为 `{foo: number, bar: string}`。如果返回值为数组，则会特别标明，如:
    
    + data: 数组，每一项包含
        - `foo`: `number`
        - `bar`: `string`
    
    则表示 `data` 项的类型为 `Array<{foo: number, bar: string}>`。
    
    特别地，若没有标注类型，则默认为 `string`。如：
    
    + data: 错误信息
    
    则表示 data 为 `string` 类型。
    
    
!!! warning "通用返回值"
    
    为了节约篇幅，将所有接口通用的异常返回信息列在这里， **在后文中便不再赘述**。
    
    若该接口需要登录，但未提供登录信息，或者登录信息无效或过期，返回
    
    + code: 401
    + data: 未登录提示信息
    
    若用户不具有访问该接口权限，返回
    
    + code: 403
    + data: 权限不足信息
    
    若请求的参数缺失或类型不符，或有多余的参数，返回
    
    + code: 400
    + data: `Array<string> | string`，所有的错误信息
    
    若请求的接口不存在，返回
    
    + code: 404
    + data: 错误信息
    
    若该接口有项目 id 的参数，但这个项目不存在，返回：
    
    + code: 404
    + data: 错误信息
    
